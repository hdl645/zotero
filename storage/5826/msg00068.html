<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Big5">


<meta name="wpd_version" content="0.2">
<meta name="wpd_baseurl" content="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00068.html">
<meta name="wpd_url" content="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00068.html">
<meta name="wpd_date" content="2008-06-03T02:57Z">
<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: ipsec NAT pass through rule(s)? -->
<!--X-From-R13: "enooghk enooghk" <enooghkNtznvy.pbz> -->
<!--X-Date: 11 Dec 2006 01:33:57 &#45;0500 -->
<!--X-Message-Id: 5cc9c8f90612102233g68f9b03o88e68614d0082445@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 5cc9c8f90612091547r4dd21922i8bf63d84b9c59c8@mail.gmail.com -->
<!--X-Reference: 1165747742.5125.15.camel@anduril.intranet.cartel&#45;securite.net -->
<!--X-Head-End-->



<title>Re: ipsec NAT pass through rule(s)?</title>

<link rev="made" href="mailto:rabbtux@gmail.com">
<link rel="start" href="http://www.securepoint.com/lists/html/NetFilter/">
<link rel="contents" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/threads.html#00068">
<link rel="index" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/index.html#00068">
<link rel="prev" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00057.html">
<link rel="next" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00070.html">

<link rel="stylesheet" type="text/css" href="msg00068.css" media="all">
</head>
<body>
<center>
<div class="msgTitle">
<span class="listTitle"><strong>NetFilter</strong></span>
</div>
<div class="metaIdxNav">
<nobr>[<a href="http://www.securepoint.com/lists/html/NetFilter/">Top</a>]</nobr>
<nobr>[<a href="http://www.securepoint.com/lists/html">All&nbsp;Lists</a>]</nobr>
</div>
</center>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<center>
<div class="topLinks">
<table class="mainNav" width="100%">
<tbody><tr>
<td width="33%" align="left"><span class="topDateNav"><nobr><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00067.html">&lt;prev</a>&nbsp;<strong>[<a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/index.html#00068">Date</a>]</strong>&nbsp;<a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00069.html">next&gt;</a></nobr></span></td>
<td width="34%" align="center"><form method="get" action="http://www.securepoint.com/lists/cgi-bin/namazu.cgi"><nobr><input name="query" size="20" type="text"><input name="submit" value="Search" type="submit"></nobr><input name="idxname" value="NetFilter" type="hidden">
<small><nobr>[<a href="http://www.securepoint.com/lists/cgi-bin/namazu.cgi?idxname=NetFilter">Advanced</a>]</nobr></small></form>
</td>
<td width="33%" align="right"><span class="topThreadNav"><nobr><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00057.html">&lt;prev</a>&nbsp;<strong>[<a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/threads.html#00068">Thread</a>]</strong>&nbsp;<a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00070.html">next&gt;</a></nobr></span></td>
</tr>
</tbody></table>
</div>
</center>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<div class="msgSubject">
<h2>Re: ipsec NAT pass through rule(s)?</h2>
<div class="msgLinks">
<table width="100%">
<tbody><tr valign="baseline">
<td align="left"><span class="authorLink">from
[<a href="http://www.securepoint.com/lists/cgi-bin/namazu.cgi?query=%2Bfrom%3Arabbtux%40gmail.com&idxname=NetFilter&sort=date%3Alate"><em>rabbtux rabbtux</em></a>]</span></td>
<td align="right"><span class="bookmarkLink">[<a href="http://www.securepoint.com/lists/cgi-bin/mesg.cgi?a=NetFilter&i=5cc9c8f90612102233g68f9b03o88e68614d0082445%40mail.gmail.com">Permanent&nbsp;Link</a>]</span><span class="orgLink">[<a href="http://www.securepoint.com/lists/cgi-bin/extract-mesg.cgi?a=NetFilter&m=2006-12&i=5cc9c8f90612102233g68f9b03o88e68614d0082445%40mail.gmail.com">Original</a>]</span></td>
</tr></tbody></table>
</div>
</div>
<div class="msgHead">
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<table>
<tbody><tr valign="baseline">
<th align="right">
<strong>To</strong>: </th>
<td align="left">

"Cedric Blancher" &lt;<a href="mailto:blancher%40cartel-securite.fr">blancher@cartel-securite.fr</a>&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>Subject</strong>: </th>
<td align="left">

Re: ipsec NAT pass through rule(s)?</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>From</strong>: </th>
<td align="left">

"rabbtux rabbtux" &lt;<a href="mailto:rabbtux%40gmail.com">rabbtux@gmail.com</a>&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>Date</strong>: </th>
<td align="left">

Sun, 10 Dec 2006 22:33:15 -0800</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>Cc</strong>: </th>
<td align="left">
<a href="mailto:netfilter%40lists.netfilter.org">netfilter@lists.netfilter.org</a></td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>Delivered-to</strong>: </th>
<td align="left">
<a href="mailto:sp-com-lists%40consult.net">sp-com-lists@consult.net</a></td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>Delivered-to</strong>: </th>
<td align="left">
<a href="mailto:netfilter-list1%40securepoint.com">netfilter-list1@securepoint.com</a></td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>Domainkey-signature</strong>: </th>
<td align="left">

a=rsa-sha1; q=dns; c=nofws; s=beta; d=gmail.com;	h=received:message-id:date:from:to:subject:cc:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;	b=BYHrZ1yNSCxQLTBxk5SgGnh7qbbuJgAYx2GkavEaj5msUnu2uZvA9hHNaUc7fiOAwVObQNBfSxoh3MgEeI5iwoLrjIo40pEbp7VBVL1O2kLltOMNphPlgKkBJrfTkf3a3E7WE5G9VIhXkeu5EIRJSOd8CBHp5fTTN8s30xF/On8=</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>In-reply-to</strong>: </th>
<td align="left">

&lt;<a href="mailto:1165747742.5125.15.camel%40anduril.intranet.cartel-securite.net"></a><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00057.html">1165747742.5125.15.camel@anduril.intranet.cartel-securite.net</a>&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>List-archive</strong>: </th>
<td align="left">

&lt;/pipermail/netfilter&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>List-help</strong>: </th>
<td align="left">

&lt;<a href="mailto:netfilter-request@lists.netfilter.org?subject=help">mailto:netfilter-request@lists.netfilter.org?subject=help</a>&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>List-id</strong>: </th>
<td align="left">

General discussion and user questions &lt;netfilter.lists.netfilter.org&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>List-post</strong>: </th>
<td align="left">

&lt;<a href="mailto:netfilter@lists.netfilter.org">mailto:netfilter@lists.netfilter.org</a>&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>List-subscribe</strong>: </th>
<td align="left">

&lt;<a href="https://lists.netfilter.org/mailman/listinfo/netfilter">https://lists.netfilter.org/mailman/listinfo/netfilter</a>&gt;,	&lt;<a href="mailto:netfilter-request@lists.netfilter.org?subject=subscribe">mailto:netfilter-request@lists.netfilter.org?subject=subscribe</a>&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>List-unsubscribe</strong>: </th>
<td align="left">

&lt;<a href="https://lists.netfilter.org/mailman/listinfo/netfilter">https://lists.netfilter.org/mailman/listinfo/netfilter</a>&gt;,	&lt;<a href="mailto:netfilter-request@lists.netfilter.org?subject=unsubscribe">mailto:netfilter-request@lists.netfilter.org?subject=unsubscribe</a>&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>References</strong>: </th>
<td align="left">

&lt;<a href="mailto:5cc9c8f90612091547r4dd21922i8bf63d84b9c59c8%40mail.gmail.com"></a><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00056.html">5cc9c8f90612091547r4dd21922i8bf63d84b9c59c8@mail.gmail.com</a>&gt;	&lt;<a href="mailto:1165747742.5125.15.camel%40anduril.intranet.cartel-securite.net"></a><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00057.html">1165747742.5125.15.camel@anduril.intranet.cartel-securite.net</a>&gt;</td>
</tr>

<tr valign="baseline">
<th align="right">
<strong>Sender</strong>: </th>
<td align="left">
<a href="mailto:netfilter-bounces%40lists.netfilter.org">netfilter-bounces@lists.netfilter.org</a></td>
</tr>

</tbody></table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
</div>
<div class="msgBody">
<table width="100%" cellspacing="1"><tbody><tr><td>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">Cedric,  I understand how to do nat to IPSEC ports and all others.  My
question is about any special rules required so that the encrypted
ipsec TCP headers don't get mangled?  I recall that parts of the TCP
header about the source address get encrypted and that this can break
the vpn through masqueraded (nat'ed ) connections.

On 12/10/06, Cedric Blancher &lt;blancher@cartel-securite.fr&gt; wrote:
</pre><blockquote style="border-left: 0.2em solid rgb(85, 85, 238); margin: 0em; padding-left: 0.85em;"><pre style="margin: 0em;">Le samedi 09 d&eacute;cembre 2006 &agrave; 15:47 -0800, rabbtux rabbtux a &eacute;crit :
&gt; Anyone have suggestions for a rule to allow IPsec packets to pass from
&gt; a NATed subnet??  I know linksys,dlink, et. all have a firewall
&gt; checkbox to alow ipsec vpns to work.

IPSEC implies IP protocols 50 (ESP) and sometimes 51 (AH). Therefore,
you have to handle them both. A (very) quick'n'dirty ESP NAT would be:

        iptables -t nat -A POSTROUTING -p 50 -j MASQUERADE
        iptables -A FORWARD -p 50 -j ACCEPT

Now, just adapt this to your own situation and push some rules with
subnet adresses, input and output interfaces, etc.


--
<a rel="nofollow" href="http://sid.rstack.org/">http://sid.rstack.org/</a>
PGP KeyID: 157E98EE FingerPrint: FA62226DA9E72FA8AECAA240008B480E157E98EE
&gt;&gt; Hi! I'm your friendly neighbourhood signature virus.
&gt;&gt; Copy me to your signature file and help me spread!

</pre></blockquote><pre style="margin: 0em;">

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</td></tr></tbody></table>
</div>
<div class="msgLinks">
<table width="100%">
<tbody><tr valign="baseline">
<td align="center"><span class="subjectLink">[<a href="http://www.securepoint.com/lists/cgi-bin/namazu.cgi?query=%2Bsubject:%2F%5E%28%3F:%5E%5Cs%2A%28re%7Csv%7Cfwd%7Cfw%29%5B%5C%5B%5C%5D%5Cd%5D%2A%5B:%3E-%5D%2B%5Cs%2A%29%2Aipsec%5Cs%2BNAT%5Cs%2Bpass%5Cs%2Bthrough%5Cs%2Brule%5C%28s%5C%29%5C%3F%5Cs%2A%24%2F&idxname=NetFilter&sort=date%3Alate">More&nbsp;with&nbsp;this&nbsp;subject...</a>]</span></td>
</tr></tbody></table>
</div>
<div class="tSlice">
<table width="100%" cellpadding="4" cellspacing="1">
<tbody><tr valign="baseline">
<td align="left"><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00057.html"><strong>&lt;Prev&nbsp;in&nbsp;Thread</strong></a>]</td>
<th width="100%" align="center"><strong>Current&nbsp;Thread</strong></th>
<td align="right">[<a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00070.html"><strong>Next&nbsp;in&nbsp;Thread&gt;</strong></a>
</td></tr>
<tr class="tSliceList"><td colspan="3">
<ul>
<li><b><a name="00056" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00056.html">ipsec NAT pass through rule(s)?</a></b>, <i>rabbtux rabbtux</i>
<ul>
<li><b><a name="00057" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00057.html">Re: ipsec NAT pass through rule(s)?</a></b>, <i>Cedric Blancher</i>
<ul>
<li><span class="sliceCur"><strong>Re: ipsec NAT pass through rule(s)?</strong>,
<em>rabbtux rabbtux</em>&nbsp;<b></b></span><b>&lt;=</b>
<ul>
<li><b><a name="00070" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00070.html">Re: ipsec NAT pass through rule(s)?</a></b>, <i>Cedric Blancher</i>
</li><li><b><a name="00078" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00078.html">Re: ipsec NAT pass through rule(s)?</a></b>, <i>rabbtux rabbtux</i>
</li><li><b><a name="00086" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00086.html">Re: ipsec NAT pass through rule(s)?</a></b>, <i>Cedric Blancher</i>
</li><li><b><a name="00095" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00095.html">Re: ipsec NAT pass through rule(s)?</a></b>, <i>rabbtux rabbtux</i>
</li><li><b><a name="00097" href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00097.html">Re: ipsec NAT pass through rule(s)?</a></b>, <i>Cedric Blancher</i>
</li>




</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</td></tr>
</tbody></table></div>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<div class="botLinks">
<table width="100%">
<tbody><tr valign="baseline">
<th align="right">Previous&nbsp;by&nbsp;Date:&nbsp;</th>
<td width="100%"><strong><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00067.html">Re: how do I set the MAC address in POSTROUTING?</a></strong>, <em>Cedric Blancher</em></td>
</tr>
<tr valign="baseline">
<th align="right">Next&nbsp;by&nbsp;Date:&nbsp;</th>
<td width="100%"><strong><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00069.html">psad-2.0 release</a></strong>, <em>Michael Rash</em></td>
</tr>
<tr valign="baseline">
<th align="right">Previous&nbsp;by&nbsp;Thread:&nbsp;</th>
<td width="100%"><strong><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00057.html">Re: ipsec NAT pass through rule(s)?</a></strong>, <em>Cedric Blancher</em></td>
</tr>
<tr valign="baseline">
<th align="right">Next&nbsp;by&nbsp;Thread:&nbsp;</th>
<td width="100%"><strong><a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/msg00070.html">Re: ipsec NAT pass through rule(s)?</a></strong>, <em>Cedric Blancher</em></td>
</tr>
<tr valign="baseline">
<th align="right">Indexes:&nbsp;</th>
<td>[<a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/index.html#00068"><strong>Date</strong></a>]
[<a href="http://www.securepoint.com/lists/html/NetFilter/2006-12/threads.html#00068"><strong>Thread</strong></a>]
[<a href="http://www.securepoint.com/lists/html/NetFilter/"><strong>Top</strong></a>]
[<a href="http://www.securepoint.com/lists/html"><strong>All&nbsp;Lists</strong></a>]</td>
</tr>
</tbody></table>
</div>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
